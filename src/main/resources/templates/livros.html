<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Livros</title>
    <meta charset="UTF-8">
  	<meta name="viewport" content="width=device-width, initial-scale=1.0">
  	<link rel="stylesheet" th:href="@{/css/styles.css}" />
  	<link rel="stylesheet" th:href="@{/css/table.css}" />
  	<link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
</head>
<body>
<div class="wrapper">
	<h1 class="destaque">Livros ðŸ“š</h1>
	<div id="carouselExample" class="carousel slide">
	  <div class="carousel-inner">
	    <div class="carousel-item active">
	      <div>
		 	<h2>Adicionar Livro</h2>
		    <form class="d-block w-100" th:action="@{/livros/create}" th:object="${livroDTO}" method="post">
		        <input required class="input-box" placeholder="nome" type="text" id="nome" name="nome"><br>
		        <input required class="input-box" placeholder="autor" type="text" id="autor" name="autor"><br>
		        <input required class="input-box" placeholder="editora" type="text" id="editora" name="editora"><br>
		        <input required class="input-box" placeholder="isbn" type="number" id="isbn" name="isbn"><br>
		        <input required class="btn" type="submit" value="Adicionar">
		    </form>
		  </div>
	    </div>
    
    <div class="carousel-item table-div">
		 <h2>Lista de Livros</h2>
		    <table class="custom-table">
				<thead class="custom-thead">
		        <tr>
		            <th>ID</th>
		            <th>TÃ­tulo</th>
		            <th>Autor</th>
		            <th>Editora</th>
		            <th>ISBN</th>
		            <th>Editar</th>
		            <th>Deletar</th>
		        </tr>
		        </thead>
		        
		        <tbody class="custom-tbody">
			        <tr th:each="livro : ${livros}" class="livro-row">
			            <td data-label="id" th:text="${livro.id}"></td>
			            <td data-label="nome" th:text="${livro.nome}"></td>
			            <td data-label="autor" th:text="${livro.autor}"></td>
			            <td data-label="editora" th:text="${livro.editora}"></td>
			            <td data-label="isbn" th:text="${livro.isbn}"></td>
			            <td>
			                <button class="edit-button btnf" th:data-id="${livro.id}">Editar</button>
			            </td>
			            <td>
			                <button class="botÃ£odedelete btnf" th:data-id="${livro.id}">Deletar</button>
			            </td>			            
			        </tr>
			     <tr class="edit-form-row" style="display: none;">
                     <td colspan="7">
                         <div class="edit-form ">
                             Editar livro
<!--						<form th:action="@{/livros/edit/{id}(id=*{id})}" th:object="${livroDTO}" method="post">-->
							<form th:action="@{/livros/edit/{id}(id=${livroDTO.id})}" th:object="${livroDTO}" method="post">
	               		        <input type="hidden" th:field="*{id}" />
	                            <label for="nome">Nome:</label>
	           		            <input type="text" th:field="*{nome}" /><br>
                                <label for="autor">Autor:</label>
                                <input type="text" th:field="*{autor}" /><br>
                                <label for="editora">Editora:</label>
                                <input type="text" th:field="*{editora}" /><br>
                                <label for="isbn">ISBN:</label>
                                <input type="text" th:field="*{isbn}" /><br>
                                <button type="submit" th:href="@{/livros}">Salvar</button>
 								<a class="cancel-button" th:href="@{/livros}">Cancelar</a>
 							</form>
                        </div>
                    </td>
                </tr>
		        </tbody>
		    </table> 
	    </div>
	  </div>
	</div>
	  	
	  	<button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
		    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
		    <span class="visually-hidden">Previous</span>
	  	</button>
	  	<button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
		    <span class="carousel-control-next-icon" aria-hidden="true"></span>
		    <span class="visually-hidden">Next</span>
	  	</button>
</div>


    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script th:inline="javascript">
    	 var livros = /*[[${livros}]]*/;
   	</script>
	<script>
	    $(document).ready(function () {
	
	        $('.edit-button').click(function () {
				console.log("Button clicked")
	            
	            var row = $(this).find('livro-row');
				var editForm = $('.edit-form-row');
	
	            row.hide();
	            editForm.show();
	
	            var livroId = $(this).data('id');
	            var livro = livros.find(function (l) { return l.id === livroId; });
	            	            
	            var form = editForm.find('form');
	            form.find('[name="id"]').val(livro.id);
	            form.find('[name="nome"]').val(livro.nome);
	            form.find('[name="autor"]').val(livro.autor);
	            form.find('[name="editora"]').val(livro.editora);
	            form.find('[name="isbn"]').val(livro.isbn);
	            console.log(livroId)
	            console.log(livro)
	            console.log(row)
	            console.log(livro.id)
	            console.log(livro.nome)
	            
	        });
	
	        $('.cancel-button').click(function () {
	            var editForm = $(this).closest('.edit-form-row:visible');
	            var row = editForm.prev('livro-row');
	            
	            // Hide edit form row and show livro information row
	            editForm.hide();
	            row.show();
	        });
	
	        // Click event listener for document
	        $(document).click(function (event) {
	            var target = $(event.target);
	            
	            // Check if the click was outside the edit form
	            if (!target.closest('.edit-form-row').length && !target.hasClass('edit-button')) {
	                var editForm = $('.edit-form-row');
	                var row = editForm.prev('livro-row');
	                
	                // Hide edit form row and show livro information row
	                editForm.hide();
	                row.show();
	            }
	        });
	    });
	</script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
</body>
</html>
